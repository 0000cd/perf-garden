# 使用示例

<cite>
**本文档中引用的文件**   
- [PerfGarden.py](file://PerfGarden.py)
- [README.md](file://README.md)
</cite>

## 目录
1. [AI对话性能分析](#ai对话性能分析)
2. [图片上传状态检测](#图片上传状态检测)
3. [界面变化时间点识别](#界面变化时间点识别)

## AI对话性能分析

本示例演示如何通过检测对话气泡的出现来测量AI响应延迟。在AI对话场景中，用户发送请求后，系统通常会先显示加载动画，随后开始输出文字内容。通过检测文字内容开始出现的时间点，可以精确测量AI的响应延迟。

**背景说明**：在AI对话应用中，性能指标的关键在于从用户发送请求到AI开始回复的时间。传统的手动计时方法耗时且容易出错，而使用图像识别技术可以自动化这一过程。

**配置文件内容**：
```yaml
- path: "C:/Users/YourName/Documents/test_data"
- max_threads: 8

- cattail:
    - template: "C:/Users/YourName/Documents/templates/send_button.jpg"
    - crop: 50
    - fade: true

- cactus:
    - threshold: 1.0

- skip: 20

- cattail:
    - template: "C:/Users/YourName/Documents/templates/share_icon.jpg"
    - crop: 50
```

**配置说明**：
1. 第一个`cattail`任务检测发送按钮消失，表示用户已发送请求，开始计时。
2. `cactus`任务检测图像变化，自动使用第一张图片作为模板，检测到1%以上的差异即认为AI开始输出内容。
3. `skip`任务跳过20张图片，避免加载动画的干扰。
4. 第二个`cattail`任务检测分享图标出现，表示AI回复完成。

**预期结果解读**：运行后生成的CSV文件将包含每个测试轮次的关键时间点。通过计算发送按钮消失到文字内容出现的帧数差，再乘以帧率，即可得到精确的AI响应延迟。例如，如果帧率为30fps，相差15帧，则响应延迟为0.5秒。

**为何选择此配置**：`cactus`方法特别适合此场景，因为AI输出的文字内容是动态变化的，无法使用固定的模板匹配。而`cactus`通过比较像素级差异，能有效检测到文字气泡的出现，且无需手动设置复杂的参数。

**Section sources**
- [README.md](file://README.md#L90-L94)
- [PerfGarden.py](file://PerfGarden.py#L88-L187)

## 图片上传状态检测

本示例展示如何利用图像差异检测（cactus）识别上传进度条的变化。在图片上传场景中，上传进度通常通过进度条或加载动画来表示，这些动态元素难以用传统的模板匹配方法检测。

**背景说明**：当用户上传图片时，系统会显示上传进度。准确检测上传完成的时间点对于性能测试至关重要。由于进度条是连续变化的，使用`cactus`方法可以有效捕捉这一过程。

**配置文件内容**：
```yaml
- path: "C:/Users/YourName/Documents/upload_test"
- max_threads: 8

- cattail:
    - template: "C:/Users/YourName/Documents/templates/upload_button.jpg"
    - crop: 30
    - fade: true

- cactus:
    - threshold: 5.0
    - enable_denoising: true

- blover:
    - threshold: 1
    - crop: -50
    - fade: true
```

**配置说明**：
1. 第一个`cattail`任务检测上传按钮消失，表示上传开始。
2. `cactus`任务检测图像变化，阈值设置为5.0以适应较大的进度条变化，启用降噪处理以减少噪点干扰。
3. `blover`任务检测加载动画中的圆圈，裁剪顶部50%区域以聚焦上传区域，设置`fade: true`以检测加载动画消失，表示上传完成。

**预期结果解读**：生成的CSV文件将记录上传开始、进度变化和上传完成的时间点。通过分析这些时间点，可以评估上传性能。例如，从上传开始到加载动画消失的时间即为总上传时间。

**为何选择此配置**：`cactus`方法能有效检测进度条的连续变化，而`blover`方法专门用于检测圆形加载动画。两者结合使用，可以全面捕捉上传过程中的关键状态变化。

**Section sources**
- [README.md](file://README.md#L96-L123)
- [PerfGarden.py](file://PerfGarden.py#L88-L187)

## 界面变化时间点识别

本示例说明如何组合使用`skip`和`cattail`任务来高效定位APP界面切换的关键帧。在复杂的APP测试中，界面切换可能伴随着过渡动画，直接检测目标界面可能因动画干扰而失败。

**背景说明**：当APP从一个界面切换到另一个界面时，通常会有过渡动画。直接检测目标界面的元素可能会因为动画过程中的模糊或变形而失败。通过合理使用`skip`任务跳过动画阶段，可以提高检测的准确性和效率。

**配置文件内容**：
```yaml
- path: "C:/Users/YourName/Documents/app_test"
- max_threads: 8

- cattail:
    - template: "C:/Users/YourName/Documents/templates/home_icon.jpg"
    - crop: 20
    - fade: true

- skip: 15

- cattail:
    - template: "C:/Users/YourName/Documents/templates/settings_icon.jpg"
    - crop: 20
    - leap: 2
```

**配置说明**：
1. 第一个`cattail`任务检测首页图标消失，表示界面切换开始。
2. `skip`任务跳过15张图片，这对应于典型的过渡动画持续时间。
3. 第二个`cattail`任务检测设置界面图标出现，使用`leap: 2`实现智能间隔检测，提高处理速度。

**预期结果解读**：CSV文件将记录界面切换开始和目标界面出现的时间点。通过计算时间差，可以评估界面切换的流畅度。跳过过渡动画阶段可以避免在动画过程中进行不必要的检测，从而提高整体处理效率。

**为何选择此配置**：`skip`任务可以有效避开过渡动画的干扰，而`leap`参数可以实现智能间隔检测，在保证不漏检的同时大幅提升处理速度。这种组合特别适合处理包含复杂动画的界面切换场景。

**Section sources**
- [README.md](file://README.md#L125-L155)
- [PerfGarden.py](file://PerfGarden.py#L267-L381)