# 快速开始

<cite>
**本文档中引用的文件**   
- [PerfGarden.py](file://PerfGarden.py)
- [README.md](file://README.md)
</cite>

## 目录
1. [简介](#简介)
2. [安装依赖](#安装依赖)
3. [准备图片文件夹](#准备图片文件夹)
4. [编写YAML配置文件](#编写yaml配置文件)
5. [执行PerfGarden脚本](#执行perfgarden脚本)
6. [端到端示例：检测界面元素出现时间](#端到端示例检测界面元素出现时间)
7. [验证安装与解读报告](#验证安装与解读报告)
8. [常见问题与解决方案](#常见问题与解决方案)
9. [总结](#总结)

## 简介

性能花园（Perf Garden）是一个基于 Python 和 OpenCV 的高效图像自动化框架，专为批量图像识别设计。它能够自动化处理“录屏分帧打标”等测试 APP 性能的场景，替代人工机械操作。本指南将帮助您在最短时间内完成项目部署并成功运行首次任务。

**Section sources**
- [README.md](file://README.md#L1-L20)

## 安装依赖

要运行性能花园项目，您需要安装以下 Python 依赖包：

```bash
pip install opencv-python numpy pyyaml
```

这些包分别用于图像处理（OpenCV）、数值计算（NumPy）和配置文件解析（PyYAML）。确保您的 Python 环境已正确配置，并且 `pip` 命令可用。

**Section sources**
- [README.md](file://README.md#L12)

## 准备图片文件夹

性能花园要求图片按照特定结构组织。请遵循以下步骤准备您的图片数据：

1. 将每组任务的图片按数字顺序命名（如 `1.jpg`, `2.jpg` 等）。
2. 将每组图片放入一个独立的子文件夹中（如 `task_1/`, `task_2/`）。
3. 将所有子文件夹集中到一个总文件夹中。
4. （可选）创建 `templates/` 文件夹存放模板图片。

最终的文件结构应如下所示：

```text
总文件夹/
├── config.yml
├── task_1/
│   ├── 1.jpg
│   ├── 2.jpg
│   └── ...
├── task_2/
│   └── ...
└── 处理结果.csv
templates/
```

**Section sources**
- [README.md](file://README.md#L15-L25)

## 编写YAML配置文件

YAML 配置文件是性能花园的核心，它定义了任务的执行流程。以下是关键配置项的说明：

### 全局参数
- **path**: 指定总文件夹的路径，注意使用正斜杠 `/` 或双反斜杠 `\\`，并用引号包围。
- **max_threads**: 设置最大并行线程数，建议设置为 CPU 核心数，以提升处理速度。

### 任务类型
- **cattail**: 使用模板匹配方法，适合识别按钮、图标等固定元素。
- **cactus**: 使用图像差异检测方法，无需模板，适合检测内容开始加载等动态变化。
- **blover**: 检测图片中的圆圈数量，适合识别加载动画。
- **skip**: 跳过指定数量的图片，用于跳过加载或过渡动画。

### 通用配置参数
- **crop**: 裁剪图片区域，正值保留底部，负值保留顶部。
- **fade**: 布尔值，`true` 表示检测目标出现后消失，`false` 表示检测目标出现。
- **leap**: 智能间隔，每隔几张图片检查一次，提高效率。

一个完整的 YAML 配置示例如下：

```yaml
- path: "C:/Users/.../测试"
- max_threads: 8
- cattail:
    - template: "c:/Users/.../button.jpg"
    - crop: 30
    - fade: true
- cactus:
- blover:
    - crop: -50
    - fade: true
- skip: 80
- cattail:
    - template: "c:/Users/.../share.jpg"
    - crop: 50
```

**Section sources**
- [README.md](file://README.md#L40-L184)

## 执行PerfGarden脚本

准备好依赖、图片和配置文件后，即可执行 `PerfGarden.py` 脚本。在脚本的 `if __name__ == "__main__":` 部分，修改 `yaml_path` 变量为您的 YAML 配置文件路径：

```python
if __name__ == "__main__":
    yaml_path = r"C:\Users\...\config.yml"  # 替换为实际路径
    results = gate_from_yaml(yaml_path)
```

然后在命令行中运行：

```bash
python PerfGarden.py
```

脚本将自动处理所有子文件夹中的图片，并将结果实时输出到终端。

**Section sources**
- [PerfGarden.py](file://PerfGarden.py#L733-L737)

## 端到端示例：检测界面元素出现时间

以下是一个完整的示例，演示如何检测 AI 对话应用中图片上传的性能指标：

### 任务目标
1. 检测图片导入开始（按钮消失）
2. 检测内容开始加载（图像变化）
3. 检测上传完成（加载圆圈消失）
4. 检测 AI 回复完成（分享图标出现）

### 配置文件
```yaml
- path: "C:/Users/.../AI测试"
- max_threads: 4
- cattail:
    - template: "C:/Users/.../templates/import_button.jpg"
    - crop: 30
    - fade: true
- cactus:
- blover:
    - crop: -50
    - fade: true
- skip: 80
- cattail:
    - template: "C:/Users/.../templates/share_icon.jpg"
    - crop: 50
```

此配置将依次执行五个任务，最终生成包含每个关键时间点对应帧的 CSV 报告。

**Section sources**
- [README.md](file://README.md#L186-L236)

## 验证安装与解读报告

运行脚本后，终端将显示实时处理进度。如果安装成功，您将看到类似以下的输出：

```
🌾 Perf Garden 已就绪…… 请坐和放宽！
开始多线程处理，最大线程数: 8
【进展】子文件夹 任务 (2): 任务 1 (cattail), 匹配 frame_00032.jpg, 状态 PASS, 耗时 0.41 秒
...
✅【完成】子文件夹 任务 (2) 处理完成，耗时：0.65 秒
...
🌾 所有任务完成！总用时：0.67 秒，Have A Nice Day~ 🌾🌾🌾🌾🌾🌾
结果已保存到：C:\Users\...\测试\处理结果.csv
```

生成的 CSV 报告文件包含每个子文件夹的处理结果，列名对应任务类型和序号，单元格内容为匹配成功的图片文件名或状态码。通过分析这些帧号，可以计算出精确的性能指标。

**Section sources**
- [README.md](file://README.md#L238-L268)

## 常见问题与解决方案

### 依赖安装失败
- **问题**: `pip install` 命令执行失败。
- **解决方案**: 确保网络连接正常，尝试使用国内镜像源，如 `pip install -i https://pypi.tuna.tsinghua.edu.cn/simple opencv-python numpy pyyaml`。

### 图片路径错误
- **问题**: 脚本报错“读取图片失败”。
- **解决方案**: 检查图片路径是否正确，确保路径使用正斜杠 `/` 或双反斜杠 `\\`，并确认图片文件存在。

### 配置文件格式错误
- **问题**: YAML 文件解析失败。
- **解决方案**: 使用在线 YAML 验证工具检查语法，确保缩进正确，键值对使用冒号加空格分隔。

### cattail 匹配失败
- **问题**: 模板匹配一直失败。
- **解决方案**: 确保模板图片是从任务图片中直接裁剪得到的，且尺寸和角度一致。避免使用截图或不同设备的图片作为模板。

**Section sources**
- [README.md](file://README.md#L249-L268)

## 总结

通过本指南，您已成功部署并运行了性能花园项目。该项目作为一个命令行工具（CLI），通过简单的 YAML 配置即可实现复杂的图像自动化任务。遵循上述步骤，即使是具备基本 Python 和命令行知识的开发者也能独立完成部署和首次运行。随着您对配置参数的深入理解，可以构建更复杂的任务流水线，以满足多样化的性能测试需求。

**Section sources**
- [README.md](file://README.md#L1-L268)
- [PerfGarden.py](file://PerfGarden.py#L1-L738)